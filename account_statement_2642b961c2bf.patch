# exporting patch:
# HG changeset patch
# User CÃ©dric Krier <ced@b2ck.com>
# Date 1417619605 -3600
#      Wed Dec 03 16:13:25 2014 +0100
# Node ID 2642b961c2bfcf69b078d81dc552650aa84df261
# Parent  23e4eaac8bff56366f2b52a10fe13953b2528f39
# Add missing company domain/field

# issue4311
# review7691002

diff -r 23e4eaac8bff -r 2642b961c2bf statement.py
--- a/modules/account_statement/statement.py	Tue Dec 02 12:54:50 2014 +0100
+++ b/modules/account_statement/statement.py	Wed Dec 03 16:13:25 2014 +0100
@@ -66,12 +66,12 @@
     journal = fields.Many2One('account.statement.journal', 'Journal',
         required=True, select=True,
         domain=[
-            ('company', '=', Eval('context', {}).get('company', -1)),
+            ('company', '=', Eval('company', -1)),
             ],
         states={
             'readonly': (Eval('state') != 'draft') | Eval('lines', [0]),
             },
-        depends=['state'])
+        depends=['state', 'company'])
     currency_digits = fields.Function(fields.Integer('Currency Digits'),
         'on_change_with_currency_digits')
     date = fields.Date('Date', required=True, states=_STATES, depends=_DEPENDS,
@@ -435,7 +435,10 @@
             ('kind', '!=', 'view'),
             ])
     description = fields.Char('Description')
-    move = fields.Many2One('account.move', 'Account Move', readonly=True)
+    move = fields.Many2One('account.move', 'Account Move', readonly=True,
+        domain=[
+            ('company', '=', Eval('_parent_statement', {}).get('company', -1)),
+            ])
     invoice = fields.Many2One('account.invoice', 'Invoice',
         domain=[
             If(Bool(Eval('party')), [('party', '=', Eval('party'))], []),
@@ -571,6 +574,7 @@
             journal=self.statement.journal.journal,
             date=self.date,
             origin=self,
+            company=self.statement.company,
             lines=move_lines,
             )
         move.save()
