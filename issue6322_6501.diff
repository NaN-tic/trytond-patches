diff -r dcef1b340df0 trytond/modules/commission/commission.py
--- a/trytond/trytond/modules/commission/commission.py	Wed Jan 04 00:28:37 2017 +0100
+++ b/trytond/trytond/modules/commission/commission.py	Fri Nov 17 13:33:24 2017 +0100
@@ -143,7 +143,12 @@
         'Compute commission amount for the amount'
         if pattern is None:
             pattern = {}
-        pattern['product'] = product.id if product else None
+        if product:
+            pattern['category'] = product.category.id if product.category else None
+            pattern['product'] = product.id
+        else:
+            pattern['category'] = None
+            pattern['product'] = None
         context = self.get_context_formula(amount, product)
         for line in self.lines:
             if line.match(pattern):
@@ -155,6 +160,8 @@
     __name__ = 'commission.plan.line'
     plan = fields.Many2One('commission.plan', 'Plan', required=True,
         ondelete='CASCADE')
+    category = fields.Many2One(
+        'product.category', "Category", ondelete='CASCADE')
     product = fields.Many2One('product.product', 'Product')
     sequence = fields.Integer('Sequence')
     formula = fields.Char('Formula', required=True,
diff -r dcef1b340df0 trytond/trytond/modules/commission/view/plan_line_form.xml
--- a/trytond/trytond/modules/commission/view/plan_line_form.xml	Wed Jan 04 00:28:37 2017 +0100
+++ b/trytond/trytond/modules/commission/view/plan_line_form.xml	Fri Nov 17 13:33:24 2017 +0100
@@ -5,11 +5,12 @@
     <label name="plan"/>
     <field name="plan"/>
     <newline/>
-    <label name="product"/>
-    <field name="product"/>
     <label name="sequence"/>
     <field name="sequence"/>
-    <newline/>
+    <label name="category"/>
+    <field name="category"/>
+    <label name="product"/>
+    <field name="product"/>
     <label name="formula"/>
-    <field name="formula" colspan="3"/>
+    <field name="formula" colspan="4"/>
 </form>
diff -r dcef1b340df0 trytond/trytond/modules/commission/view/plan_line_list.xml
--- a/trytond/trytond/modules/commission/view/plan_line_list.xml	Wed Jan 04 00:28:37 2017 +0100
+++ b/trytond/trytond/modules/commission/view/plan_line_list.xml	Fri Nov 17 13:33:24 2017 +0100
@@ -4,6 +4,7 @@
 <tree string="Commission Plan Lines">
     <field name="plan"/>
     <field name="sequence"/>
+    <field name="category"/>
     <field name="product"/>
     <field name="formula"/>
 </tree>
diff -r dcef1b340df0 trytond/trytond/modules/commission/view/plan_line_list_sequence.xml
--- a/trytond/trytond/modules/commission/view/plan_line_list_sequence.xml	Wed Jan 04 00:28:37 2017 +0100
+++ b/trytond/trytond/modules/commission/view/plan_line_list_sequence.xml	Fri Nov 17 13:33:24 2017 +0100
@@ -2,6 +2,7 @@
 <!-- This file is part of Tryton.  The COPYRIGHT file at the top level of
 this repository contains the full copyright notices and license terms. -->
 <tree string="Commission Plan Lines" sequence="sequence">
+    <field name="category"/>
     <field name="product"/>
     <field name="formula"/>
 </tree>
